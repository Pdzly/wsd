FROM node:20-alpine

WORKDIR /wsd-frontend

ARG SENTRY_AUTH_TOKEN
ARG NEXT_PUBLIC_WSD__NAME
ARG NEXT_PUBLIC_WSD__DOMAIN
ARG NEXT_PUBLIC_WSD__API__BASE_URL
ARG NEXT_PUBLIC_WSD__API__AUTH_BASE_URL
ARG NEXT_PUBLIC_WSD__LANGUAGE
ARG NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__DSN
ARG NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__TRACES_SAMPLE_RATE
ARG NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_SESSION_SAMPLE_RATE
ARG NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_ON_ERROR_SAMPLE_RATE
ARG NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__GOOGLE_ANALYTICS__GA_ID

ENV SENTRY_AUTH_TOKEN=$SENTRY_AUTH_TOKEN
ENV NEXT_PUBLIC_WSD__NAME=$NEXT_PUBLIC_WSD__NAME
ENV NEXT_PUBLIC_WSD__DOMAIN=$NEXT_PUBLIC_WSD__DOMAIN
ENV NEXT_PUBLIC_WSD__API__BASE_URL=$NEXT_PUBLIC_WSD__API__BASE_URL
ENV NEXT_PUBLIC_WSD__API__AUTH_BASE_URL=$NEXT_PUBLIC_WSD__API__AUTH_BASE_URL
ENV NEXT_PUBLIC_WSD__LANGUAGE=$NEXT_PUBLIC_WSD__LANGUAGE
ENV NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__DSN=$NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__DSN
ENV NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__TRACES_SAMPLE_RATE=$NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__TRACES_SAMPLE_RATE
ENV NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_SESSION_SAMPLE_RATE=$NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_SESSION_SAMPLE_RATE
ENV NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_ON_ERROR_SAMPLE_RATE=$NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_ON_ERROR_SAMPLE_RATE
ENV NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__GOOGLE_ANALYTICS__GA_ID=$NEXT_PUBLIC_WSD__FRONT_END__DEVTOOLS__GOOGLE_ANALYTICS__GA_ID

COPY . /wsd-frontend/

RUN npm install --frozen-lockfile
RUN npm run build

ENV NODE_ENV=production

EXPOSE 3000

RUN chmod +x /wsd-frontend/entrypoint.sh
ENTRYPOINT ["/wsd-frontend/entrypoint.sh"]
